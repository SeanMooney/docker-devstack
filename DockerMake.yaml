
base:
    FROM: ubuntu:14.04

proxy:
    requires: 
    - base
    build: |
        ENV PIP_INDEX_URL=http://192.168.1.10:3141/root/pypi/+simple/
        ENV PIP_TRUSTED_HOST=192.168.1.10
        RUN echo 'Acquire::HTTP::Proxy "http://192.168.1.10:3142";' > /etc/apt/apt.conf ; \
            echo 'Acquire::HTTPS::Proxy "false";' >> /etc/apt/apt.conf
        RUN apt-get update ; apt-get upgrade -y ; apt-get install -y software-properties-common \
            python-software-properties ; apt-get autoclean

tools:
    requires: 
    - proxy
    build: |
        RUN  apt-get install -y --no-install-recommends wget git socat tshark nano firefox git mc \
             netcat iperf iproute net-tools default-jdk build-essential && apt-get autoclean

freerds:
    requires: 
    - tools
    build_directory: freerds
    build: |
        RUN apt-get install -qy --force-yes --no-install-recommends \ 
            cmake xorg; apt-get autoclean
        COPY prep.sh prep.sh
        RUN chmod +x prep.sh ; ./prep.sh 
        COPY build.sh build.sh
        RUN chmod +x build.sh ; ./build.sh 
        COPY freerds.conf /etc/supervisor/conf.d/freerds.conf

user:
    requires: 
    - proxy
    build: |
        RUN useradd --shell /bin/bash --create-home tester ; echo tester:tester | chpasswd
        RUN echo "tester    ALL=(ALL:ALL) ALL" | tee -a /etc/sudoers

init:
    requires: 
    - proxy
    build_directory: init
    build: |
        RUN apt-get install -y --no-install-recommends supervisor; apt-get autoclean
        COPY init.conf /etc/supervisor/conf.d/init.conf
        CMD ["supervisord","-n"]
        EXPOSE 3389
lxde:
    requires: 
    - proxy
    build_directory: lxde
    build: |
        RUN apt-get install -y --no-install-recommends \
            lxde-core bash lxterminal ; apt-get autoclean

kde:
     requires:
     - proxy
     build_directory: kde
     build: |
        RUN apt-get install -y --no-install-recommends kde-plasma-desktop && apt-get autoclean


lxde-freerds:
    requires: 
    - tools
    - init
    - freerds
    - user
    - lxde

kde-freerds:
    requires: 
    - tools
    - init
    - freerds
    - user
    - kde

