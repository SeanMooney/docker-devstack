DockerDevstackBase:
    FROM: ubuntu:14.04
    build: |
        ENV PIP_INDEX_URL=http://192.168.1.10:3141/root/pypi/+simple/
        ENV PIP_TRUSTED_HOST=192.168.1.10
        RUN echo 'Acquire::HTTP::Proxy "http://192.168.1.10:3142";' > /etc/apt/apt.conf ; \
            echo 'Acquire::HTTPS::Proxy "false";' >> /etc/apt/apt.conf
        RUN apt-get update ; apt-get upgrade -y ; apt-get install -y software-properties-common \
            python-software-properties ; apt-get autoclean


tools:
    requires: 
    - DockerDevstackBase
    build: |
        RUN  apt-get install -y --no-install-recommends git socat tshark nano firefox git mc \
             netcat iperf iproute net-tools default-jdk build-essential && apt-get autoclean


xrdp:
    requires: 
    - DockerDevstackBase
    build_directory: xrdp
    build: |
        RUN apt-get install -qy --force-yes --no-install-recommends \ 
            x11-xserver-utils libxrandr2 libfuse2 xutils \
            libxfixes3 libx11-dev pulseaudio xrdp ; apt-get autoclean
        RUN sed -i '/TerminalServerUsers/d' /etc/xrdp/sesman.ini && \
            sed -i '/TerminalServerAdmins/d' /etc/xrdp/sesman.ini

init:
    requires: 
    - DockerDevstackBase
    build_directory: init
    build: |
        #RUN apt-get install -y supervisor; apt-get autoclean
        #COPY init.conf /etc/supervisor/conf.d/init.conf
        CMD ["/sbin/init"]
        EXPOSE 3389
user:
    requires: 
    - DockerDevstackBase
    build: |
        RUN useradd tester ; mkdir /home/tester ; chown -R tester:tester /home/tester ; echo tester:tester | chpasswd


lxqt:
    requires: 
    - DockerDevstackBase
    build_directory: lxqt
    build: |
        RUN add-apt-repository -y ppa:lubuntu-dev/lubuntu-daily ; \
            apt-get update; apt-get install -y --no-install-recommends  lxqt-metapackage lxqt-panel openbox ; \
            apt-get autoremove ; apt-get autoclean
        COPY .Xclients /etc/skel/.Xclients

kde:
    requires: 
    - DockerDevstackBase
    build_directory: kde
    build: |
        RUN apt-get install -y --no-install-recommends kde-plasma-desktop && apt-get autoclean
        COPY .Xclients /etc/skel/.Xclients

xfce:
    requires: 
    - DockerDevstackBase
    build: |
        RUN apt-get install -y --no-install-recommends kde-plasma-desktop && apt-get autoclean

cinnamon:
    requires: 
    - DockerDevstackBase
    build_directory: cinnamon
    build: |
        RUN add-apt-repository ppa:tsvetko.tsvetkov/cinnamon ; \
            apt-get update; apt-get install --no-install-recommends  cinnamon -y ; apt-get autoremove ; apt-get autoclean
        COPY .Xclients /etc/skel/.Xclients

kde-xrdp:
    requires: 
    - kde
    - tools
    - xrdp
    - user
    - init

cinnamon-xrdp:
    requires: 
    - cinnamon
    - tools
    - xrdp
    - user
    - init

xfce-xrdp:
    requires: 
    - xfce
    - tools
    - xrdp
    - user
    - init
